מסמך אפיון - מערכת PhoneInfo
============================

תיאור כללי
----------

מערכת PhoneInfo היא כלי לאימות זהות על בסיס מספרי טלפון.
המערכת מקבלת קובץ אקסל עם מספרי טלפון ושמות מאנשי קשר,
ומשווה אותם מול מידע שמתקבל מממשק ME API חיצוני.

המערכת מחשבת ציון התאמה בין השם שמופיע באנשי הקשר
לבין השם האמיתי של בעל מספר הטלפון.

מטרת המערכת
-----------

זיהוי מספרי טלפון חשודים שייתכן ונגנבו או זויפו.
כאשר השם באנשי הקשר שונה משמעותית מהשם האמיתי,
זו אינדיקציה לכך שמדובר במספר שאינו שייך לאדם המקורי.


קבצי המערכת
-----------

server.py
    שרת Flask עם ממשק אינטרנט וממשקי REST API.
    מספק עיבוד קבצים, שאילתות בודדות, תעתיק וכינויים.

functions.py
    קובץ פונקציות עזר.
    כולל חיבור לממשק API, ניהול מסד נתונים, חישוב התאמה ועוד.

api_me.py
    לקוח לממשק ME API החיצוני.

templates/
    תיקיית תבניות HTML לממשק האינטרנט.
    index.html - דף העלאת קבצים
    query.html - דף שאילתה בודדת

db/
    תיקיית מסד הנתונים.
    verify.db - מסד נתונים SQLite לשמירת תוצאות מהממשק.
    משמש כמטמון לחיסכון בקריאות API חוזרות.

.env.example
    קובץ דוגמה למשתני סביבה.
    יש להעתיק ל-.env ולמלא את הערכים.


משתני סביבה
-----------

משתני סביבה נדרשים (בקובץ .env):
    ME_API_URL      כתובת ה-API
    ME_API_SID      מזהה SID לממשק
    ME_API_TOKEN    טוקן אימות לממשק

משתני סביבה אופציונליים:
    DATABASE        נתיב למסד הנתונים (ברירת מחדל: db/verify.db)
    HOST            כתובת האזנה (ברירת מחדל: 0.0.0.0)
    PORT            פורט האזנה (ברירת מחדל: 5001)
    DEBUG           מצב פיתוח (ברירת מחדל: true)


הפעלת המערכת
------------

התקנה:
    1. העתק .env.example ל-.env
    2. מלא את הערכים בקובץ .env
    3. pip install -r requirements.txt

הפעלת השרת:
    python server.py

הפעלה עם Docker:
    docker-compose up -d

גישה לממשק:
    http://localhost:5001


ממשק האינטרנט
-------------

דף העלאת קבצים (/)
    העלאת קובץ Excel או CSV
    בחירת ממשקים (ME, SYNC)
    הגדרת ימי עדכון
    הורדת קובץ תוצאות

דף שאילתה בודדת (/web/query)
    הזנת מספר טלפון
    הזנת שם מאנשי קשר (אופציונלי)
    צפייה בתוצאות מפורטות


פורמט קובץ הקלט
---------------

קובץ אקסל בפורמט XLSX או CSV עם שתי עמודות:

עמודה ראשונה: מספר טלפון
    יכול להיות בפורמט ישראלי מקומי או בינלאומי.
    המערכת ממירה אוטומטית לפורמט בינלאומי.
    דוגמאות:
        0501234567 יומר ל 972501234567
        +972501234567 יומר ל 972501234567
        972501234567 נשאר כמות שהוא

עמודה שניה: שם מאנשי הקשר
    השם כפי שמופיע ברשימת אנשי הקשר של המשתמש.
    משמש להשוואה מול השם האמיתי מהממשק.


פורמט קובץ הפלט
---------------

קובץ אקסל בפורמט XLSX עם העמודות הבאות:

phone_number
    מספר הטלפון בפורמט בינלאומי

cal_name
    השם מאנשי הקשר כפי שהוזן בקלט

me.common_name
    השם הנפוץ מהממשק

me.matching
    ציון ההתאמה בין השמות באחוזים

me.result_strength
    עוצמת התוצאה מהממשק

me.translated
    תעתיק השם לעברית

me.profile_name
    שם הפרופיל מהממשק

me.first_name
    שם פרטי

me.last_name
    שם משפחה

me.email
    כתובת דואר אלקטרוני

me.email_confirmed
    האם הדואר האלקטרוני מאומת

me.profile_picture
    קישור לתמונת פרופיל

me.gender
    מגדר

me.is_verified
    האם המשתמש מאומת

me.slogan
    סיסמה או תיאור אישי

me.social.facebook
    קישור לפייסבוק

me.social.twitter
    קישור לטוויטר

me.social.spotify
    קישור לספוטיפיי

me.social.instagram
    קישור לאינסטגרם

me.social.linkedin
    קישור ללינקדאין

me.social.pinterest
    קישור לפינטרסט

me.social.tiktok
    קישור לטיקטוק

me.whitelist
    האם המספר ברשימה לבנה

me.api_call_time
    זמן הקריאה לממשק


ימי עדכון
---------

0 = שימוש במטמון בלבד (ברירת מחדל)
    לא מבצע קריאות API חדשות.
    משתמש רק בנתונים קיימים במסד הנתונים.

1+ = עדכון רשומות ישנות
    מרענן רשומות שזמן הקריאה שלהן ישן מ-N ימים.


מערכת הכינויים
--------------

המערכת תומכת בהתאמת כינויים לשמות רשמיים.
זה מאפשר זיהוי נכון כאשר באנשי הקשר מופיע כינוי
והממשק מחזיר את השם הרשמי או להפך.

פורמט קובץ הכינויים:
    שם_רשמי:כינוי1,כינוי2,כינוי3

דוגמאות:
    יוסף:יוסי,יוס,סיפו
    אברהם:אבי,אברום,אברם
    בנימין:בני,בנצי
    שרה:שרי,שרלה
    רבקה:ריבי,בקי

טבלת הכינויים נשמרת במסד הנתונים (verify.db).
ניתן לערוך את הכינויים ישירות בטבלה או לייצא לאקסל.


אלגוריתם חישוב ההתאמה
---------------------

המערכת משתמשת באלגוריתם התאמת מחרוזות מטושטשת.

שלב 1: הרחבת שם אנשי הקשר
    כל מילה בשם מורחבת עם כל הכינויים האפשריים.
    דוגמה: יוסי כהן מורחב ל: יוסי יוסף יוס סיפו כהן

שלב 2: תעתיק השם מהממשק
    שמות בערבית או רוסית מתורגמים לעברית.
    זה מאפשר השוואה גם כאשר השמות בשפות שונות.

שלב 3: חיפוש התאמות
    לכל מילה בשם המורחב, מוצאת ההתאמה הטובה ביותר בשם מהממשק.
    ההתאמה מחושבת באחוזים מ-0 עד 100.

שלב 4: חישוב הציון הסופי
    נלקחות שתי ההתאמות הטובות ביותר.
    הציון הסופי הוא הממוצע שלהן.

דוגמה:
    שם באנשי קשר: יוסי כהן
    שם מהממשק: יוסף כהן
    התאמת שם פרטי: 100 (יוסף מתאים ליוסי דרך הכינויים)
    התאמת שם משפחה: 100
    ציון סופי: 100

דוגמה נוספת:
    שם באנשי קשר: דני לוי
    שם מהממשק: משה כהן
    התאמת שם פרטי: 30
    התאמת שם משפחה: 40
    ציון סופי: 35


פרשנות הציונים
--------------

90-100: התאמה מצוינת
    סביר להניח שמדובר באותו אדם.

70-89: התאמה טובה
    ייתכן שמדובר באותו אדם עם שינויי כתיב קלים.

50-69: התאמה חלקית
    יש להמשיך לבדוק, ייתכן שם משפחה זהה עם שם פרטי שונה.

0-49: התאמה נמוכה
    סביר להניח שמדובר באנשים שונים.
    המספר עלול להיות גנוב או מזויף.


מסד הנתונים
-----------

המערכת משתמשת במסד נתונים SQLite לשמירת נתונים.

טבלת me_data:
    שומרת את התוצאות מממשק ME.
    מאפשרת שימוש חוזר ללא קריאות API נוספות.

טבלת sync_data:
    שומרת את התוצאות מממשק SYNC (בפיתוח).

טבלת nicknames:
    שומרת את מיפוי הכינויים.

שדות בטבלת me_data:
    phone_number: מספר הטלפון (מפתח ראשי)
    cal_name: שם מאנשי הקשר
    api_call_time: זמן הקריאה לממשק
    שאר השדות: נתונים מהממשק

שדות בטבלת nicknames:
    id: מזהה ייחודי
    formal_name: השם הרשמי
    all_names: כל השמות והכינויים מופרדים בפסיק


תעתיק שמות
----------

המערכת תומכת בתעתיק שמות משפות שונות לעברית.

שפות נתמכות:
    ערבית
    רוסית
    אנגלית

התעתיק מאפשר השוואה נכונה כאשר:
    באנשי הקשר השם בעברית
    ובממשק השם בשפה אחרת

דוגמאות תעתיק מערבית:
    محمد מתורגם ל מוחמד
    أحمد מתורגם ל אחמד

דוגמאות תעתיק מרוסית:
    Александр מתורגם ל אלכסנדר
    Михаил מתורגם ל מיכאל


REST API
--------

POST /me
    חיפוש מספר טלפון בממשק ME.
    קלט: { "phone": "972501234567", "cal_name": "שם" }
    פלט: תוצאות מהממשק

POST /translate
    תעתיק שמות לעברית.
    קלט: { "first": "David", "last": "Cohen" }
    פלט: { "first": "דויד", "last": "כהן" }

GET /nicknames?name=David
    קבלת כל הכינויים לשם.
    פלט: { "names": ["David", "Dave", "דוד"] }

POST /compare
    חישוב ציון התאמה בין שמות.
    קלט: { "first": "דוד", "last": "כהן", "names": ["David"], "target_last": "Cohen" }
    פלט: { "score": 85 }

GET /health
    בדיקת תקינות השרת.
    פלט: { "status": "ok" }


דרישות מערכת
------------

Python 3.8 ומעלה

ספריות נדרשות:
    pandas: עיבוד נתוני אקסל
    openpyxl: קריאה וכתיבה של קבצי XLSX
    requests: קריאות HTTP לממשק
    fuzzywuzzy: התאמת מחרוזות מטושטשת
    python-Levenshtein: שיפור ביצועים להתאמת מחרוזות
    Flask: שרת REST API

התקנת הספריות:
    pip install -r requirements.txt


מבנה התיקיה
-----------

phoneinfo/
    server.py           שרת Flask
    functions.py        פונקציות עזר
    api_me.py           ממשק ME API
    .env                משתני סביבה (לא ב-git)
    db/
        verify.db       מסד נתונים
    templates/          תבניות HTML
        index.html      דף העלאת קבצים
        query.html      דף שאילתה בודדת
    venv/               סביבה וירטואלית
    CLAUDE.md           תיעוד למפתחים


סיכום
-----

מערכת PhoneInfo מספקת כלי יעיל לאימות זהות על בסיס מספרי טלפון.
באמצעות שילוב של ממשק ME API חיצוני, מערכת כינויים מתקדמת,
ואלגוריתם התאמה חכם, המערכת מזהה מספרים חשודים בדיוק גבוה.

המערכת מתאימה לשימוש בארגונים פיננסיים, חברות ביטוח,
ועסקים אחרים הזקוקים לאימות זהות לקוחות.
